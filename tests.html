<meta charset="utf-8">
<script src="./generate-alt.js"></script>


<link rel="stylesheet" href="./test-micro-framework/test-micro-framework.css">

<script type="module">
  import { it, assertEqual } from "./test-micro-framework/test-micro-framework.js"

  // -------------------
  // Pluralise
  // -------------------

  it("pluralise: pluralises when count is 0", () => {
    assertEqual(
      pluralise(0, "eddie"),
      "eddies"
    );
  });

  it("pluralise: pluralises when count is negative", () => {
    assertEqual(
      pluralise(-20, "eddie"),
      "eddies"
    );
  });

  it("pluralise: pluralises when count is positive", () => {
    assertEqual(
      pluralise(20, "eddie"),
      "eddies"
    );
  });

  it("pluralise: does not pluralise when count is 1", () => {
    assertEqual(
      pluralise(1, "eddie"),
      "eddie"
    );
  });

  // -------------------
  // parseResults
  // -------------------

  it("parseResults: works with missing keys", () => {
    const testResults = { correct: 2 }

    assertEqual(
      parseResults(testResults),
      "2 correct guesses."
    );
  });

  it("parseResults: ignores invalid keys", () => {
    const testResults = { correct: 5, faker: 100, hint: 5 }

    assertEqual(
      parseResults(testResults),
      "5 correct guesses. 5 hints."
    );
  })

  it("parseResults: correctly orders output with a mix of all valid keys", () => {
    const testResults = { doubleHint: 10, correct: 4, mistake: 1, hint: 5 }

    assertEqual(
      parseResults(testResults),
      "4 correct guesses. 1 mistake. 5 hints. 10 double hints."
    );
  })

  it("parseResults: renders a nicer message when all are correct", () => {
    const testResults = { correct: 20 }

    assertEqual(
      parseResults(testResults),
      "Clean sweep! All correct with no mistakes or hints."
    );
  })

  // -------------------
  // countResults
  // -------------------

  it("countResults: instatiates items missing in accumulator", () => {
    const resultTotals = {}
    const testResultLine = "ğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ¨"

    assertEqual(
      countResults(testResultLine, resultTotals),
      { correct: 3, mistake: 1 }
    );
  })

  it("countResults: ignores invalid keys", () => {
    const resultTotals = {}
    const testResultLine = "ğŸŸ©ğŸ‘ï¸ğŸŸ©ğŸŸ¨"

    assertEqual(
      countResults(testResultLine, resultTotals),
      { correct: 2, mistake: 1 }
    );
  })

  it("countResults: adds new counts to existing accumulator", () => {
    const resultTotals = { correct: 8, hint: 2, doubleHint: 5, mistake: 1 }
    const testResultLine = "ğŸŸ©ğŸŸ¨ğŸŸ¡ğŸŸ "

    countResults(testResultLine, resultTotals);

    assertEqual(
      resultTotals,
      { correct: 9, hint: 3, doubleHint: 6, mistake: 2 }
    );
  })

  it("countResults: returns updated counts", () => {
    const resultTotals = { correct: 8, hint: 2, doubleHint: 5, mistake: 1 }
    const testResultLine = "ğŸŸ©ğŸŸ¨ğŸŸ¡ğŸŸ "

    assertEqual(
      countResults(testResultLine, resultTotals),
      { correct: 9, hint: 3, doubleHint: 6, mistake: 2 }
    );
  })

  // -------------------
  // generateAltText
  // -------------------

  it("generateAltText: returns nothing if no regexes match", () => {
    const testResults = "hi i'm eddie";

    assertEqual(
      generateAltText(testResults),
      "\n\n"
    );
  })

  it("generateAltText: returns preamble & link", () => {
    const testResults = "I solved the daily Clues by Sam, Jan 1st 1970 (Evil), in 00:00\nhttps://cluesbysam.com";

    assertEqual(
      generateAltText(testResults),
      "I solved the daily Clues by Sam, Jan 1st 1970 (Evil), in 00:00\n\nhttps://cluesbysam.com"
    );
  })

  it("generateAltText: supports variations in preamble format", () => {
    const testResults = "I solved the daily Clues by Sam (Jan 1st 1970) in less than 20 minutes\nhttps://cluesbysam.com";

    assertEqual(
      generateAltText(testResults),
      "I solved the daily Clues by Sam (Jan 1st 1970) in less than 20 minutes\n\nhttps://cluesbysam.com"
    );
  })

  it("generateAltText: accumulates multiple rows of results", () => {
    const testResults = "I solved the daily Clues by Sam, (Jan 1st 1970) in less than 20 minutes\nğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ©\nğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ©\nğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ¨\nğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ©\nğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ©\nhttps://cluesbysam.com";

    assertEqual(
      generateAltText(testResults),
      "I solved the daily Clues by Sam, (Jan 1st 1970) in less than 20 minutes\n19 correct guesses. 1 mistake.\nhttps://cluesbysam.com"
    );
  })
</script>
